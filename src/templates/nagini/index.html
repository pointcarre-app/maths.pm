{% extends "base/main-alt.html" %}

{% block title %}
  {% if product_metatags and product_metatags.title %}
    {{ product_metatags.title }}
  {% else %}
    {{ product_title or "Nagini - Python dans le navigateur" }}
  {% endif %}
{% endblock title %}

{% block extra_head %}
  {# Product-specific metatags override defaults #}
  {% if product_metatags %}
    {# SEO metatags #}
    {% if product_metatags.description %}
      <meta name="description" content="{{ product_metatags.description }}" />
    {% endif %}
    {% if product_metatags.keywords %}
      <meta name="keywords" content="{{ product_metatags.keywords }}" />
    {% endif %}
    {% if product_metatags.robots %}
      <meta name="robots" content="{{ product_metatags.robots }}" />
    {% endif %}

    {# Open Graph metatags #}
    {% if product_metatags['og:title'] %}
      <meta property="og:title" content="{{ product_metatags['og:title'] }}" />
    {% endif %}
    {% if product_metatags['og:description'] %}
      <meta property="og:description" content="{{ product_metatags['og:description'] }}" />
    {% endif %}
    {% if product_metatags['og:url'] %}
      <meta property="og:url" content="{{ product_metatags['og:url'] }}" />
    {% endif %}

    {# Twitter Card metatags #}
    {% if product_metatags['twitter:card'] %}
      <meta name="twitter:card" content="{{ product_metatags['twitter:card'] }}" />
    {% endif %}
    {% if product_metatags['twitter:title'] %}
      <meta name="twitter:title" content="{{ product_metatags['twitter:title'] }}" />
    {% endif %}
    {% if product_metatags['twitter:description'] %}
      <meta name="twitter:description" content="{{ product_metatags['twitter:description'] }}" />
    {% endif %}
  {% endif %}

  {# Load product backend settings (Nagini-specific scripts) #}
  {% if product_backend_settings and product_backend_settings.nagini %}
    {% set nagini_settings = product_backend_settings.nagini %}
    {% if nagini_settings.js_url %}<script src="{{ nagini_settings.js_url }}"></script>{% endif %}
    {% if nagini_settings.pyodide_worker_url %}
      <script>
          window.NAGINI_WORKER_URL = "{{ nagini_settings.pyodide_worker_url }}";
      </script>
    {% endif %}
  {% endif %}
{% endblock extra_head %}

{% block content %}
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">

      <!-- Header Section -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">üêç {{ product_title or "Nagini" }}</h1>
        <p class="text-xl text-gray-600 mb-6">
          {{ product_description or "Ex√©cution de code Python directement dans le navigateur" }}
        </p>
      </div>

      <!-- Product Status -->
      {% if product_settings %}
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
          <div class="flex">
            <div class="ml-3">
              <p class="text-sm text-blue-700">
                <strong>Status:</strong>
                {% if is_enabled %}
                  <span class="text-green-600">‚úÖ Activ√©</span>
                {% else %}
                  <span class="text-red-600">‚ùå D√©sactiv√©</span>
                {% endif %}
              </p>
              {% if nagini_endpoint %}
                <p class="text-sm text-blue-700">
                  <strong>Endpoint:</strong> <code>{{ nagini_endpoint }}</code>
                </p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}

      <!-- Main Content -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">üöÄ Python dans le navigateur</h2>

        <div class="max-w-none">
          <p class="text-gray-700 mb-4">
            Nagini permet d'ex√©cuter du code Python directement dans votre navigateur,
            sans installation locale. Id√©al pour l'enseignement et l'apprentissage interactif.
          </p>

          <h3 class="text-lg font-semibold text-gray-900 mb-2">‚ú® Fonctionnalit√©s</h3>
          <ul class="list-disc list-inside text-gray-700 mb-4">
            <li>Ex√©cution Python via Pyodide</li>
            <li>Interface interactive</li>
            <li>Pas d'installation requise</li>
            <li>Id√©al pour l'√©ducation</li>
          </ul>
        </div>
      </div>

      <!-- Technical Details -->
      {% if product_settings %}
        <div class="bg-gray-50 rounded-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">üîß Configuration technique</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% if nagini_js_url %}
              <div>
                <h3 class="font-medium text-gray-900">Script JavaScript</h3>
                <p class="text-sm text-gray-600 break-all">{{ nagini_js_url }}</p>
              </div>
            {% endif %}

            {% if pyodide_worker_url %}
              <div>
                <h3 class="font-medium text-gray-900">Pyodide Worker</h3>
                <p class="text-sm text-gray-600 break-all">{{ pyodide_worker_url }}</p>
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Back Navigation -->
      <div class="text-center mt-8">
        <a href="{{ url_for('index') }}"
           class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          ‚Üê Retour √† l'accueil
        </a>
      </div>
    </div>
  </div>
{% endblock content %}

{% block extra_js %}
  <!-- Nagini-specific JavaScript would go here -->
  {% if nagini_js_url %}
    <script>
        console.log('Nagini endpoint:', '{{ nagini_endpoint }}');
        console.log('Nagini JS URL:', '{{ nagini_js_url }}');
        console.log('Pyodide Worker URL:', '{{ pyodide_worker_url }}');
    </script>
  {% endif %}
{% endblock extra_js %}
