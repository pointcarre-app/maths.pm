<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>
      {% block title %}
        {{
        DOMAIN_CONFIG['index_view_specific_metatags']['title'] }}
      {% endblock
      title %}
    </title>
    {% include "base/favicon.html" %}
    {% include "base/imports.html" %}
    {#
Generic domain-wide metatags from domain config #}
    {% if
      DOMAIN_CONFIG.domain_specific_metatags %}
      {# Essential technical metatags #}
      {% if DOMAIN_CONFIG.domain_specific_metatags['theme-color'] %}
        <meta name="theme-color" content="{{ DOMAIN_CONFIG.domain_specific_metatags['theme-color'] }}" />
      {% endif %}
      {# Business/Site identity #}
      {% if
        DOMAIN_CONFIG.domain_specific_metatags.subject %}
        <meta name="subject" content="{{ DOMAIN_CONFIG.domain_specific_metatags.subject }}" />
      {% endif %}

      {% if DOMAIN_CONFIG.domain_specific_metatags.copyright %}
        <meta name="copyright" content="{{ DOMAIN_CONFIG.domain_specific_metatags.copyright }}" />
      {% endif %}

      {% if DOMAIN_CONFIG.domain_specific_metatags.language %}
        <meta name="language" content="{{ DOMAIN_CONFIG.domain_specific_metatags.language }}" />
      {% endif %}

      {% if DOMAIN_CONFIG.domain_specific_metatags.Classification %}
        <meta name="Classification" content="{{ DOMAIN_CONFIG.domain_specific_metatags.Classification }}" />
      {% endif %}

      {% if DOMAIN_CONFIG.domain_specific_metatags.rating %}
        <meta name="rating" content="{{ DOMAIN_CONFIG.domain_specific_metatags.rating }}" />
      {% endif %}
      {# Mobile optimization #}
      {% if
        DOMAIN_CONFIG.domain_specific_metatags.HandheldFriendly %}
        <meta name="HandheldFriendly" content="{{ DOMAIN_CONFIG.domain_specific_metatags.HandheldFriendly }}" />
      {% endif %}

      {% if DOMAIN_CONFIG.domain_specific_metatags.MobileOptimized %}
        <meta name="MobileOptimized" content="{{ DOMAIN_CONFIG.domain_specific_metatags.MobileOptimized }}" />
      {% endif %}
      {# Open Graph site-wide #}
      {% if
        DOMAIN_CONFIG.domain_specific_metatags['og:site_name'] %}
        <meta property="og:site_name" content="{{ DOMAIN_CONFIG.domain_specific_metatags['og:site_name'] }}" />
      {% endif %}
      {# Twitter site-wide #}
      {% if
        DOMAIN_CONFIG.domain_specific_metatags['twitter:site'] %}
        <meta name="twitter:site" content="{{ DOMAIN_CONFIG.domain_specific_metatags['twitter:site'] }}" />
      {% endif %}

    {% endif %}
    {# Page-specific defaults from
index_view_specific_metatags - can be overridden #} {# Only apply defaults
if no product-specific metatags are provided #}
    {% if not product_metatags
      %}
      <meta name="description" content="{{ DOMAIN_CONFIG['index_view_specific_metatags']['description'] }}" />
      <meta name="keywords" content="{{ DOMAIN_CONFIG['index_view_specific_metatags']['keywords'] }}" />
    {% endif %}
    <meta name="author" content="{{ DOMAIN_CONFIG['domain_specific_metatags']['author'] }}" />

    <!-- Custom head elements from domain config -->
    {% if DOMAIN_CONFIG.extra_head %}

      {% for js_url in
        DOMAIN_CONFIG.extra_head.js %}
        <script src="{{ js_url }}"></script>
      {% endfor %}

      {% for css_url in DOMAIN_CONFIG.extra_head.css %}
        <link rel="stylesheet" href="{{ css_url }}" />
      {% endfor %}

    {% endif %}

    {# Smart Product Dependency Loader - Handles both auto-detection and explicit settings #}
    {% if product_backend_settings %}
      {# Use explicitly provided backend settings (e.g., from corsica router) #}
      <!-- Loading dependencies from product_backend_settings -->

      {# Load CSS dependencies if they exist #}
      {% if product_backend_settings.css_dependencies %}
        {% for css_dep in product_backend_settings.css_dependencies %}
          <link rel="stylesheet" href="{{ css_dep }}" />
        {% endfor %}
      {% endif %}

      {# Load JS dependencies if they exist #}
      {% if product_backend_settings.js_dependencies %}
        {% for js_dep in product_backend_settings.js_dependencies %}
          <script src="{{ js_dep }}"></script>
        {% endfor %}
      {% endif %}

      {# Also support legacy format with individual settings having js_url/css_url #}
      {% for setting_key, setting_value in product_backend_settings.items() %}
        {% if setting_value is mapping %}
          {% if setting_value.js_url %}<script src="{{ setting_value.js_url }}"></script>{% endif %}
          {% if setting_value.css_url %}
            <link rel="stylesheet" href="{{ setting_value.css_url }}" />
          {% endif %}
        {% endif %}
      {% endfor %}

    {% else %}
      {# Auto-detect based on URL route #}
      {% set path_segments = request.url.path.strip('/').split('/') %}
      {% set current_route = path_segments[0] if path_segments and path_segments[0] else '' %}

      {% if current_route %}
        {% for product in products %}
          {% if product.name == current_route and product.backend_settings %}
            <!-- Auto-loading {{ product.name }} dependencies (route: /{{ current_route }}) -->

            {# Load CSS dependencies if they exist #}
            {% if product.backend_settings.css_dependencies %}
              {% for css_dep in product.backend_settings.css_dependencies %}
                <link rel="stylesheet" href="{{ css_dep }}" />
              {% endfor %}
            {% endif %}

            {# Load JS dependencies if they exist #}
            {% if product.backend_settings.js_dependencies %}
              {% for js_dep in product.backend_settings.js_dependencies %}
                <script src="{{ js_dep }}"></script>
              {% endfor %}
            {% endif %}

            {# Also support legacy format with individual settings having js_url/css_url #}
            {% for setting_key, setting_value in product.backend_settings.items() %}
              {% if setting_value is mapping %}
                {% if setting_value.js_url %}<script src="{{ setting_value.js_url }}"></script>{% endif %}
                {% if setting_value.css_url %}
                  <link rel="stylesheet" href="{{ setting_value.css_url }}" />
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endif %}

    <script>
        // Set backend settings as a global JS object
        // ... existing code ...
    </script>

    {% block extra_head %}

    {% endblock extra_head %}
  </head>

  {% include "base/bg.html" %}

  <body class="text-base-content font-sans min-h-screen">
    {% include "base/data-brick.html" %}

    {% include "base/navbar-alt.html" %}
    {#
{% include "base/below-navbar.html" %} #}
    {% include "sujets0/drawer.html"
    %}

    <main class="mx-auto ">


      {% block content %}

      {% endblock content %}
    </main>

    <!-- Navbar active state management -->
    <script src="{{ request.url_for('static', path='js/navbar-active-state.js') }}"></script>

    {% block footers %}

      {% include DOMAIN_CONFIG['templating']['footer_template'] %}

    {% endblock footers %}
  </body>
</html>

<!-- Subscription Call-to-Action
      <section class="my-12 p-6 bg-base-200 rounded-lg text-center">
        <h2 class="text-2xl font-semibold mb-4">
Subscribe to My Newsletter
        </h2>
        <p class="mb-6">
Get the latest posts delivered straight to your inbox.
        </p>
        <form action="/subscribe" method="POST" class="flex justify-center">
          <input type="email" placeholder="Enter your email" class="input input-bordered w-full max-w-xs mr-2" required />
          <button type="submit" class="btn btn-primary">
Subscribe
          </button>
        </form>
      </section>
-->
