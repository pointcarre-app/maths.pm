{# Fonts #}
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&family=Dancing+Script:wght@400..700&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Lora:ital,wght@0,400..700;1,400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet" />


{# Lexend + Playfair Display #}
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
      rel="stylesheet" />

{# Cdns #}
<script>
    // Suppress Tailwind production warning for development
    window.process = {
        env: {
            NODE_ENV: 'development'
        }
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
<script type="tailwind-config">
    {
        plugins: [
            tailwind.plugin.typography,
        ],
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
<link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />

<link rel="stylesheet" href="{{ request.url_for('static', path='css/root.css') }}" />
<link rel="stylesheet" href="{{ request.url_for('static', path='css/styles.css') }}" />
<link rel="stylesheet" href="{{ request.url_for('static', path='css/styles-alt.css') }}" />


{# Katex #}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>


{# First version #}
{# <script>
     document.addEventListener("DOMContentLoaded", function() {
         if (typeof renderMathInElement !== 'undefined') {
             renderMathInElement(document.body, {
                 delimiters: [{
                     left: '$$',
                     right: '$$',
                     display: true
                 }, {
                     left: '$',
                     right: '$',
                     display: false
                 }],
                 throwOnError: false
             });
         } else {
             // Retry after a short delay if KaTeX isn't loaded yet
             setTimeout(function() {
                 if (typeof renderMathInElement !== 'undefined') {
                     renderMathInElement(document.body, {
                         delimiters: [{
                             left: '$$',
                             right: '$$',
                             display: true
                         }, {
                             left: '$',
                             right: '$',
                             display: false
                         }],
                         throwOnError: false
                     });
                 }
             }, 500);
         }
     });
 </script> #}

{# Look for script mondule #}
{# <script>
     // In imports.html, replace the entire DOMContentLoaded:
     document.addEventListener("DOMContentLoaded", function() {
         // Check for script modules that need to generate content
         const scriptModules = document.querySelectorAll('[data-f_type="script_module_"]');
         const hasGenerators = Array.from(scriptModules).some(script =>
             script.textContent.includes('Question Generator') ||
             script.textContent.includes('generateFragments')
         );

         if (hasGenerators) {
             // Wait for all generators to finish
             let generatorsCompleted = 0;
             const totalGenerators = scriptModules.length;

             document.addEventListener('generator-completed', function() {
                 generatorsCompleted++;
                 if (generatorsCompleted >= totalGenerators) {
                     renderMathOnBody(); // Render everything at once
                 }
             });
         } else {
             // Normal immediate rendering
             renderMathOnBody();
         }
     });

     // In your script (after fragment injection):
     document.dispatchEvent(new CustomEvent('generator-completed'));
 </script> #}

{# Inject window.delayMathRendering #}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        if (window.delayMathRendering) {
            console.log('‚è≥ Math rendering delayed, waiting for signal...');
            document.addEventListener('render-math-now', function() {
                console.log('üéØ Rendering all math content now!');

                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(document.body, {
                        delimiters: [{
                            left: '$$',
                            right: '$$',
                            display: true
                        }, {
                            left: '$',
                            right: '$',
                            display: false
                        }],
                        throwOnError: false
                    });
                } else {
                    // Retry after a short delay if KaTeX isn't loaded yet
                    setTimeout(function() {
                        if (typeof renderMathInElement !== 'undefined') {
                            renderMathInElement(document.body, {
                                delimiters: [{
                                    left: '$$',
                                    right: '$$',
                                    display: true
                                }, {
                                    left: '$',
                                    right: '$',
                                    display: false
                                }],
                                throwOnError: false
                            });
                        }
                    }, 500);
                }


            });
        } else {


            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [{
                        left: '$$',
                        right: '$$',
                        display: true
                    }, {
                        left: '$',
                        right: '$',
                        display: false
                    }],
                    throwOnError: false
                });
            } else {
                // Retry after a short delay if KaTeX isn't loaded yet
                setTimeout(function() {
                    if (typeof renderMathInElement !== 'undefined') {
                        renderMathInElement(document.body, {
                            delimiters: [{
                                left: '$$',
                                right: '$$',
                                display: true
                            }, {
                                left: '$',
                                right: '$',
                                display: false
                            }],
                            throwOnError: false
                        });
                    }
                }, 500);
            }


        }
    });
</script>
