{% extends "base/main-alt.html" %}

{% block title %}
  {{ page.title }} - {{ DOMAIN_CONFIG['index_view_specific_metatags']['title'] }}
{% endblock title %}

{% block content %}
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-primary mb-2">ðŸ“š Documentation</h1>
      <p class="text-lg text-base-content/70">Complete guide to Maths.pm application</p>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumbs text-sm mb-6">
      <ul>
        <li>
          <a href="{{ url_for('index') }}" class="link link-hover">Home</a>
        </li>
        <li>README</li>
      </ul>
    </div>

    {% if error %}
      <!-- Error State -->
      <div class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg"
             class="stroke-current shrink-0 h-6 w-6"
             fill="none"
             viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>{{ readme_content|safe }}</span>
      </div>
    {% else %}
      <!-- README Content with DaisyUI Prose -->
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <!-- Table of Contents Button -->
          <div class="flex justify-end mb-4">
            <button class="btn btn-outline btn-sm" onclick="toggleTOC()">
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="h-4 w-4 mr-1"
                   fill="none"
                   viewBox="0 0 24 24"
                   stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
              Table of Contents
            </button>
          </div>

          <!-- README Content with Custom DaisyUI Prose Styling -->
          <article class="prose-daisy">{{ readme_content|safe }}</article>
        </div>
      </div>

      <!-- Back to Top Button -->
      <div class="fixed bottom-6 right-6">
        <button class="btn btn-circle btn-primary shadow-lg"
                onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
          <svg xmlns="http://www.w3.org/2000/svg"
               class="h-6 w-6"
               fill="none"
               viewBox="0 0 24 24"
               stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
          </svg>
        </button>
      </div>
    {% endif %}
  </div>

  <script>
      function toggleTOC() {
          // Simple TOC toggle - could be enhanced to show/hide a floating TOC
          const headings = document.querySelectorAll('article h1, article h2, article h3, article h4');
          if (headings.length === 0) return;

          // Create or toggle TOC modal
          const existingModal = document.getElementById('toc-modal');
          if (existingModal) {
              existingModal.remove();
              return;
          }

          // Create TOC content
          let tocContent = '<div class="menu bg-base-200 rounded-box p-4 max-h-96 overflow-y-auto">';
          tocContent += '<h3 class="font-bold text-lg mb-4">Table of Contents</h3>';

          headings.forEach((heading, index) => {
              const level = parseInt(heading.tagName.charAt(1));
              const indent = level > 1 ? 'ml-' + ((level - 1) * 4) : '';
              const id = `heading-${index}`;
              heading.id = id;

              tocContent += `<li class="${indent}"><a href="#${id}" class="text-sm hover:text-primary" onclick="closeTOC()">${heading.textContent}</a></li>`;
          });

          tocContent += '</div>';

          // Create modal
          const modal = document.createElement('div');
          modal.id = 'toc-modal';
          modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          modal.onclick = (e) => {
              if (e.target === modal) modal.remove();
          };

          modal.innerHTML = `
      <div class="bg-base-100 rounded-lg p-6 max-w-md w-full mx-4 relative">
        <button class="btn btn-sm btn-circle absolute right-2 top-2" onclick="closeTOC()">âœ•</button>
        ${tocContent}
      </div>
    `;

          document.body.appendChild(modal);
      }

      function closeTOC() {
          const modal = document.getElementById('toc-modal');
          if (modal) modal.remove();
      }

      // Smooth scroll for anchor links
      document.addEventListener('DOMContentLoaded', function() {
          const links = document.querySelectorAll('a[href^="#"]');
          links.forEach(link => {
              link.addEventListener('click', function(e) {
                  e.preventDefault();
                  const target = document.querySelector(this.getAttribute('href'));
                  if (target) {
                      target.scrollIntoView({
                          behavior: 'smooth',
                          block: 'start'
                      });
                  }
              });
          });
      });
  </script>
{% endblock content %}
