<!-- Sujets0 Generate Content - REFACTORED with unified UI -->

<!-- Configuration Section -->
<div class="font-heading text-lg sm:text-xl md:text-2xl mt-12 mb-4">
  Configurer la g√©n√©ration de copies
</div>

<div class="card bg-base-200 shadow-sm p-4 sm:p-6 md:p-8">
  <form id="arpege-form" class="w-full max-w-[720px] mx-auto">
    <div class="flex flex-col sm:flex-row gap-4 sm:gap-8">

      <!-- Left column: Number inputs -->
      <div class="flex flex-col gap-4 sm:gap-6 flex-1">
        <!-- Number of copies -->
        <fieldset class="fieldset">
          <legend class="fieldset-legend">
            <span class="font-light font-heading text-base md:text-lg">Nombre de copies</span>
            <span class="badge badge-outline badge-sm ml-2"
                  data-tooltip="Toutes les copies utiliseront les m√™mes questions avec des valeurs diff√©rentes">?</span>
          </legend>
          <div class="join w-full">
            <input type="number"
                   id="nb-eleves"
                   name="nb-eleves"
                   min="1"
                   max="50"
                   value="2"
                   required
                   class="input input-bordered join-item flex-1 h-10" />
            <button type="button"
                    class="btn btn-square join-item h-10 w-10"
                    onclick="document.getElementById('nb-eleves').stepDown()">‚àí</button>
            <button type="button"
                    class="btn btn-square join-item h-10 w-10"
                    onclick="document.getElementById('nb-eleves').stepUp()">+</button>
          </div>
          <p class="label-text-alt mt-1">Entre 1 et 50 copies</p>
        </fieldset>

        <!-- Questions per copy -->
        <fieldset class="fieldset">
          <legend class="fieldset-legend">
            <span class="font-light font-heading text-base md:text-lg">Questions par copie</span>
            <span class="badge badge-outline badge-sm ml-2"
                  data-tooltip="Une partie A d'un sujet 0 officiel compte 12 questions">?</span>
          </legend>
          <div class="join w-full">
            <input type="number"
                   id="nb-questions"
                   name="nb-questions"
                   min="1"
                   max="12"
                   value="12"
                   required
                   class="input input-bordered join-item flex-1 h-10" />
            <button type="button"
                    class="btn btn-square join-item h-10 w-10"
                    onclick="document.getElementById('nb-questions').stepDown()">‚àí</button>
            <button type="button"
                    class="btn btn-square join-item h-10 w-10"
                    onclick="document.getElementById('nb-questions').stepUp()">+</button>
          </div>
          <p class="label-text-alt mt-1">Entre 1 et 12 questions</p>
        </fieldset>
      </div>

      <!-- Right column: Specialty selection -->
      <div class="flex flex-col gap-4 sm:gap-6 flex-1">
        <fieldset class="fieldset">
          <legend class="fieldset-legend">
            <span class="font-light font-heading text-base md:text-lg">Fili√®re / Sp√©cialit√©</span>
            <span class="badge badge-outline badge-sm ml-2"
                  data-tooltip="Sp√©: Sp√©cialit√© Maths | Non Sp√©: Enseignement Sp√©cifique | Techno: Fili√®re technologique">?</span>
          </legend>
          <div class="join w-full">
            <input type="radio" name="sujets0" value="spe" class="join-item btn h-10 flex-1" aria-label="Sp√©." checked />
            <input type="radio"
                   name="sujets0"
                   value="non-spe"
                   class="join-item btn h-10 flex-1"
                   aria-label="Non Sp√©."
                   disabled />
            <input type="radio"
                   name="sujets0"
                   value="techno"
                   class="join-item btn h-10 flex-1"
                   aria-label="Techno"
                   disabled />
          </div>
          <p class="label-text-alt mt-1">Choisir un programme officiel</p>
        </fieldset>
      </div>


    </div>
    <button id="big-generate-btn"
            type="button"
            class="btn btn-primary w-full font-bold bg-primary-focus hover:bg-primary-focus border-0 mt-4">
      <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
      </svg>
      G√©n√©rer les exercices
    </button>


  </form>
</div>

<!-- Big Generate Button -->


<!-- JavaScript for form-based generation -->
<script>
    // Extract form configuration
    function extractFormConfig() {
        // Get form values
        const nbStudents = document.getElementById('nb-eleves')?.value || 2;
        const nbQuestions = document.getElementById('nb-questions')?.value || 12;

        // Get selected curriculum from radio buttons
        const curriculumRadio = document.querySelector('input[name="sujets0"]:checked');
        let curriculum = 'Sp√©'; // default

        if (curriculumRadio) {
            switch (curriculumRadio.value) {
                case 'spe':
                    curriculum = 'Sp√©';
                    break;
                case 'non-spe':
                    curriculum = 'Non-Sp√©';
                    break;
                case 'techno':
                    curriculum = 'Techno';
                    break;
                default:
                    curriculum = 'Sp√©';
            }
        }

        return {
            nbStudents,
            nbQuestions,
            curriculum
        };
    }

    // Generate exercises based on form data
    function generateFromForm() {
        const config = extractFormConfig();

        // Validate the configuration
        const nbStudents = parseInt(config.nbStudents);
        const nbQuestions = parseInt(config.nbQuestions);

        if (isNaN(nbStudents) || nbStudents < 1 || nbStudents > 50) {
            alert('‚ö†Ô∏è Le nombre de copies doit √™tre entre 1 et 50');
            return;
        }

        if (isNaN(nbQuestions) || nbQuestions < 1 || nbQuestions > 12) {
            alert('‚ö†Ô∏è Le nombre de questions doit √™tre entre 1 et 12');
            return;
        }

        console.log('üéØ Generating with config:', config);

        // Build the target URL - works for any domain
        const baseUrl = `${window.location.protocol}//${window.location.host}`;
        const targetUrl = `${baseUrl}/pm/sujets0/a_generate.md?format=html&nbStudents=${config.nbStudents}&nbQuestions=${config.nbQuestions}&curriculum=${encodeURIComponent(config.curriculum)}#teacher-answer-table`;

        console.log('üöÄ Navigating to:', targetUrl);

        // Navigate to the URL
        window.location.href = targetUrl;
    }

    // Initialize the generate button when the page loads
    function initializeGenerateButton() {
        const generateBtn = document.getElementById('big-generate-btn');
        if (generateBtn) {
            generateBtn.addEventListener('click', generateFromForm);
            console.log('‚úÖ Generate button initialized');
        } else {
            console.warn('Generate button not found');
        }
    }

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeGenerateButton);
    } else {
        initializeGenerateButton();
    }
</script>

<!-- Styles for document preview -->
<style>
    /* Tooltips */
    [data-tooltip] {
        cursor: help;
        position: relative;
    }

    [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        right: 0;
        margin-bottom: 0.5rem;
        padding: 0.5rem 0.75rem;
        background: hsl(var(--b3));
        color: hsl(var(--bc));
        font-size: 0.875rem;
        font-weight: normal;
        border-radius: 0.25rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        white-space: nowrap;
        z-index: 50;
        pointer-events: none;
    }

    /* Papyrus document structure */
    :root {
        --papyrus-margin-top: 3mm;
        --papyrus-margin-right: 8mm;
        --papyrus-margin-bottom: 3mm;
        --papyrus-margin-left: 8mm;
        --papyrus-font-size-h1: 28px;
        --papyrus-font-size-h2: 24px;
        --papyrus-font-size-h3: 20px;
        --papyrus-font-size-h4: 18px;
        --papyrus-font-size-h5: 16px;
        --papyrus-font-size-h6: 14px;
        --papyrus-font-size-body: 15px;
    }

    .papyrus-document {
        font-family: 'Spectral', serif;
    }

    .page-wrapper {
        width: 210mm;
        min-height: 297mm;
        max-height: 297mm;
        margin: 0 auto 10mm auto;
        padding: 0;
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        box-sizing: border-box;
        position: relative;
        overflow: hidden;
        page-break-after: always;
        page-break-inside: avoid;
    }

    .page-preview {
        width: 100%;
        height: 297mm;
        padding: 0;
        margin: 0;
        position: relative;
        box-sizing: border-box;
    }

    .page-content {
        padding: var(--papyrus-margin-top) var(--papyrus-margin-right) var(--papyrus-margin-bottom) var(--papyrus-margin-left);
        height: 297mm;
        width: 210mm;
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
    }

    /* Debug mode */
    .debug-mode .page-wrapper {
        border: 2px solid red;
    }

    .debug-mode .page-preview {
        border: 2px solid blue;
    }

    .debug-mode .page-content {
        border: 2px solid green;
    }

    /* Print styles */
    @page {
        margin: 0;
        size: A4;
    }

    @media print {
        .page-wrapper {
            margin: 0;
            box-shadow: none;
            page-break-after: always;
        }

        .page-content {
            padding: var(--papyrus-margin-top) var(--papyrus-margin-right) var(--papyrus-margin-bottom) var(--papyrus-margin-left);
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p {
            margin: 0;
        }
    }

    /* Safari-specific styles */
    @supports (-webkit-appearance: none) {
        .text-2xs {
            font-size: 0.625rem !important;
            line-height: 1 !important;
        }

        .text-xs {
            font-size: 0.75rem !important;
            line-height: 1rem !important;
        }

        .text-sm {
            font-size: 0.875rem !important;
            line-height: 1.25rem !important;
        }
    }
</style>
