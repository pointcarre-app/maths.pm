{% extends "base/main-alt.html" %}

{% block title %}
  {% if product_metatags and product_metatags.title %}
    {{ product_metatags.title }}
  {% else %}
    Sujets 0 - Exercices math√©matiques pour l'√©preuve anticip√©e de 1√®re
  {% endif %}
{% endblock title %}

{% block extra_head %}
  {# Product-specific metatags override defaults #}
  {% if product_metatags %}
    {# SEO metatags #}
    {% if product_metatags.description %}
      <meta name="description" content="{{ product_metatags.description }}" />
    {% endif %}
    {% if product_metatags.keywords %}
      <meta name="keywords" content="{{ product_metatags.keywords }}" />
    {% endif %}
    {% if product_metatags.robots %}
      <meta name="robots" content="{{ product_metatags.robots }}" />
    {% endif %}

    {# Open Graph metatags #}
    {% if product_metatags['og:title'] %}
      <meta property="og:title" content="{{ product_metatags['og:title'] }}" />
    {% endif %}
    {% if product_metatags['og:description'] %}
      <meta property="og:description" content="{{ product_metatags['og:description'] }}" />
    {% endif %}
    {% if product_metatags['og:image'] %}
      <meta property="og:image" content="{{ product_metatags['og:image'] }}" />
    {% endif %}
    {% if product_metatags['og:url'] %}
      <meta property="og:url" content="{{ product_metatags['og:url'] }}" />
    {% endif %}

    {# Twitter Card metatags #}
    {% if product_metatags['twitter:card'] %}
      <meta name="twitter:card" content="{{ product_metatags['twitter:card'] }}" />
    {% endif %}
    {% if product_metatags['twitter:title'] %}
      <meta name="twitter:title" content="{{ product_metatags['twitter:title'] }}" />
    {% endif %}
    {% if product_metatags['twitter:description'] %}
      <meta name="twitter:description" content="{{ product_metatags['twitter:description'] }}" />
    {% endif %}
    {% if product_metatags['twitter:image'] %}
      <meta name="twitter:image" content="{{ product_metatags['twitter:image'] }}" />
    {% endif %}

    {# Dublin Core metatags #}
    {% for key, value in product_metatags.items() %}
      {% if key.startswith('DC.') %}<meta name="{{ key }}" content="{{ value }}" />{% endif %}
    {% endfor %}

    {# Any other custom metatags #}
    {% if product_metatags.revised %}
      <meta name="revised" content="{{ product_metatags.revised }}" />
    {% endif %}
    {% if product_metatags.topic %}
      <meta name="topic" content="{{ product_metatags.topic }}" />
    {% endif %}
    {% if product_metatags.summary %}
      <meta name="summary" content="{{ product_metatags.summary }}" />
    {% endif %}
    {% if product_metatags.category %}
      <meta name="category" content="{{ product_metatags.category }}" />
    {% endif %}
  {% endif %}

  {# Backend settings disabled - we load Nagini manually in the content block #}
{% endblock extra_head %}

{% block modal_info_content %}
  {% include "sujets0/modal-info-content.html" %}
{% endblock modal_info_content %}

{% block content %}
  <div class="padding-alt-security mx-auto mb-14 mt-12 max-w-3xl ">
    {% include "sujets0/header.html" %}

    {# <div class="card shadow-lg mx-auto py-6 card mt-12">
      <h1 class="text-center text-2xl font-bold text-base-content/60 mb-1">Sujets 0</h1>
      <h2 class="text-center text-xl font-bold mb-3">
        Pour l'√©preuve anticip√©e de math√©matiques en classe de 1√®re
      </h2>
      <div class="max-w-[400px] mx-auto">{% include "products/sujets0-figure-svg.html" %}</div>
    </div> #}
    <div class="grid grid-cols-3 gap-2 sm:gap-4 max-w-4xl mx-auto mt-12">
      <button class="btn btn-sm md:btn-md  btn-neutral btn-outline btn-active" data-tab="generate">
        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-5 w-5 hidden sm:block"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="1.5"
             stroke-linecap="round"
             stroke-linejoin="round">
          <path d="M10 22V7a1 1 0 0 0-1-1H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5a1 1 0 0 0-1-1H2" />
          <rect x="14" y="2" width="8" height="8" rx="1" />
        </svg>
        <span class="font-normal">G√©n√©rer<span class="hidden sm:inline">des exercices</span> </span>
      </button>
      <button class="btn btn-sm md:btn-md btn-outline btn-neutral" data-tab="documentation">
        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-5 w-5 hidden sm:block"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="1.5"
             stroke-linecap="round"
             stroke-linejoin="round"
             class="lucide lucide-file-text-icon lucide-file-text">
          <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
          <path d="M14 2v4a2 2 0 0 0 2 2h4" />
          <path d="M10 9H8" />
          <path d="M16 13H8" />
          <path d="M16 17H8" />
        </svg>
        <span class="font-normal">
          <span class="hidden sm:inline">Lire la documentation</span>
          <span class="sm:hidden">Documentation</span>
        </span>
      </button>
      <button class="btn btn-sm md:btn-md btn-outline btn-neutral" data-tab="subjects">

        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-5 w-5 hidden sm:block"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="1.5"
             stroke-linecap="round"
             stroke-linejoin="round"
             class="lucide lucide-landmark-icon lucide-landmark">
          <path d="M10 18v-7" />
          <path d="M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z" />
          <path d="M14 18v-7" />
          <path d="M18 18v-7" />
          <path d="M3 22h18" />
          <path d="M6 18v-7" />
        </svg>
        <span class="font-normal">
          <span class="hidden sm:inline">Consulter les Sujets 0</span>
          <span class="sm:hidden">Sujets 0</span>
        </span>
      </button>
    </div>

    <div class="tab-alt-content card mt-6" id="generate-content">
      {% include "sujets0/generate-content.html" %}

      <!-- Button to execute all generators -->
      <div class="mt-6 p-4 border-t border-base-300">
        <button id="execute-all-generators-btn"
                class="btn btn-primary btn-outline btn-disabled"
                disabled
                title="Waiting for Nagini to load...">
          <svg xmlns="http://www.w3.org/2000/svg"
               class="h-5 w-5 mr-2"
               viewBox="0 0 24 24"
               fill="none"
               stroke="currentColor"
               stroke-width="2"
               stroke-linecap="round"
               stroke-linejoin="round">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          G√©n√©rer
        </button>
        <span class="ml-3 text-sm text-base-content/60">Ex√©cute 3 g√©n√©rateurs de questions</span>
      </div>

      <!-- Container for generator execution results -->
      <div id="generator-results-container"></div>
    </div>

    <div class="space-y-6 tab-alt-content tab-alt-hidden" id="documentation-content">
      <div>
        <div class="font-heading text-xl mb-2">Documentation</div>
        <div>
          Consultez la documentation compl√®te pour comprendre le fonctionnement de l'application et d√©couvrir toutes les fonctionnalit√©s disponibles.
        </div>
      </div>

      <div>
        <div class="font-heading text-xl mb-2">G√©n√©ration d'exercices</div>
        <div>
          Cette application permet de g√©n√©rer des exercices inspir√©s des Sujets 0 du minist√®re de l'√âducation nationale. Ces exercices et leurs corrections sont g√©n√©r√©s al√©atoirement gr√¢ce √† un moteur de calcul formel.
        </div>
      </div>
      <div>
        <div class="font-heading text-xl mb-2">Fonctionnalit√©s</div>
        <div>
          <ul class="list-disc list-inside mb-2">
            <li>G√©n√©ration automatique d'exercices QCM</li>
            <li>Corrections d√©taill√©es avec explications</li>
            <li>Moteur de calcul formel int√©gr√©</li>
            <li>Exercices adapt√©s aux programmes officiels</li>
          </ul>
        </div>
      </div>

      <div>
        <div class="font-heading text-xl mb-2">Guide d'utilisation</div>
        <div>
          <ul class="list-disc list-inside mb-2">
            <li>Comment g√©n√©rer des exercices</li>
            <li>Personnaliser les param√®tres</li>
            <li>Exporter les r√©sultats</li>
            <li>Int√©grer dans vos cours</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="space-y-6 tab-alt-content tab-alt-hidden" id="subjects-content">
      <div>
        <div class="font-heading text-xl mb-2">Sujets 0 de juillet 2025</div>
        <div>
          Le minist√®re a publi√© :
          <ul class="list-disc list-inside mb-2">
            <li>2 sujets 0 pour l'enseignement de sp√©cialit√©</li>
            <li>3 sujets 0 pour l'enseignement sp√©cifique</li>
            <li>2 sujets 0 pour les fili√®res technologiques</li>
          </ul>
          Chaque sujet est compos√© de 2 parties :
          <ul class="list-disc list-inside mb-2">
            <li>Partie 1 : QCM de 12 questions pour v√©rifier les automatismes</li>
            <li>Partie 2 : 2 exercices entre l'application directe et la r√©solution de probl√®mes</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
      console.log('Script is loading...');

      document.addEventListener('DOMContentLoaded', function() {
          console.log('DOM loaded!');

          // Get all tab buttons and content areas
          const tabButtons = document.querySelectorAll('[data-tab]');
          const tabContents = document.querySelectorAll('.tab-alt-content');

          console.log('Found buttons:', tabButtons.length);
          console.log('Found content areas:', tabContents.length);

          // Log each button found
          tabButtons.forEach((btn, index) => {
              console.log(`Button ${index}:`, btn.getAttribute('data-tab'));
          });

          // Add click event listeners to all buttons
          tabButtons.forEach(button => {
              console.log('Adding listener to button:', button.getAttribute('data-tab'));

              button.addEventListener('click', function(e) {
                  e.preventDefault();
                  console.log('üî• BUTTON CLICKED:', this.getAttribute('data-tab'));

                  // Remove active class from all buttons
                  tabButtons.forEach(btn => {
                      btn.classList.remove('btn-active');
                      console.log('Removed active from:', btn.getAttribute('data-tab'));
                  });

                  // Add active class to clicked button
                  this.classList.add('btn-active');
                  console.log('Added active to:', this.getAttribute('data-tab'));

                  // Get the tab name from data-tab attribute
                  const tabName = this.getAttribute('data-tab');

                  // Hide all tab contents
                  tabContents.forEach(content => {
                      content.classList.add('tab-alt-hidden');
                      console.log('Hiding content:', content.id);
                  });

                  // Show the selected tab content
                  const selectedContent = document.getElementById(tabName + '-content');
                  console.log('Looking for content ID:', tabName + '-content');
                  console.log('Selected content:', selectedContent);
                  if (selectedContent) {
                      selectedContent.classList.remove('tab-alt-hidden');
                      console.log('‚úÖ Showing content:', selectedContent.id);
                  } else {
                      console.log('‚ùå Content not found!');
                  }
              });
          });
      });

      // Also add a simple test
      //console.log('Adding test click handler...');
      //setTimeout(() => {
      //const testButton = document.querySelector('[data-tab="generate"]');
      //console.log('Test button found:', testButton);
      //if (testButton) {
      //testButton.onclick = function() {
      //console.log('DIRECT CLICK WORKED!');
      //};
      //}
      //}, 1000);
  </script>


  <script type="module">
      // Use the EXACT approach that works in the test suite
      // The error in console is harmless - esm.sh still loads the module successfully
      console.log('‚è≥ Loading Nagini from esm.sh (ignore any export errors - they are harmless)...');

      let Nagini = null;

      try {
          // This WILL show an error in console but WILL work anyway
          const naginiModule = await import('https://esm.sh/gh/pointcarre-app/nagini@v0.0.21/src/nagini.js');
          Nagini = naginiModule.Nagini;

          if (Nagini) {
              window.Nagini = Nagini;
              console.log('‚úÖ Nagini loaded successfully from esm.sh!');
              // Solved in v0.0.21
              //console.log('‚úÖ The "export" error in console is harmless - module works fine');
              //console.log('Available methods:', Object.keys(Nagini).filter(k => typeof Nagini[k] === 'function'));
          }
      } catch (e) {
          console.error('Failed to load Nagini:', e.message);


          const naginiModule = await import('https://esm.sh/gh/pointcarre-app/nagini@v0.0.21/src/nagini.js?bundle');
          Nagini = naginiModule.Nagini;

          if (Nagini) {
              window.Nagini = Nagini;
              console.log('‚úÖ Loaded with bundle parameter');
          } else {
              console.error('‚ùå Failed to load Nagini');
              const errorDiv = document.createElement('div');
              errorDiv.className = 'alert alert-error mt-4';
              errorDiv.innerHTML = `
              <strong>‚ö†Ô∏è Nagini Loading Error</strong><br />
              Failed to load Python engine from CDN. Please refresh the page.
          `;
              document.querySelector('.padding-alt-security')?.appendChild(errorDiv);
              throw new Error('Something went wrong');

          }

          console.log('‚úÖ Nagini loaded successfully!');
          console.log('Available methods:', Object.keys(Nagini).filter(k => typeof Nagini[k] === 'function'));



          // Import QuestionFactory for executing generators
          import {
              QuestionFactory
          } from "/static/js/core/question-factory.js";

          // Simple configuration - no backend settings needed
          let naginiManager = null;
          let generatedQuestions = [];

          // Simple test function
          async function testNaginiExecution() {
              if (!Nagini) return false;

              try {
                  console.log("üß™ Testing Python execution...");

                  // Create manager with simple setup
                  const manager = await Nagini.createManager(
                      'pyodide',
                      [], // No extra packages for now
                      [],
                      [],
                      'https://cdn.jsdelivr.net/gh/pointcarre-app/nagini@v0.0.21/src/pyodide/worker/worker-dist.js'
                  );

                  await Nagini.waitForReady(manager);

                  // Execute simple Python code
                  const result = await manager.executeAsync('test.py', `
result = 42 * 2
print(f"The answer is {result}")
result
              `);

                  console.log("‚úÖ Python execution successful!");
                  console.log("Output:", result.stdout);

                  // Store the manager
                  naginiManager = manager;

                  // Success - but don't show UI message
                  console.log("‚úÖ Python engine ready!");

                  return true;
              } catch (error) {
                  console.error("‚ùå Test failed:", error);
                  return false;
              }
          }

          // Test with packages (optional)
          async function testWithPackages() {
              if (!Nagini) return false;

              try {
                  console.log("üß™ Loading packages and teachers module...");

                  // Files to load for teachers module
                  const filesToLoad = [{
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/__init__.py",
                      path: "teachers/__init__.py",
                  }, {
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/generator.py",
                      path: "teachers/generator.py",
                  }, {
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/maths.py",
                      path: "teachers/maths.py",
                  }, {
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/formatting.py",
                      path: "teachers/formatting.py",
                  }, {
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/corrector.py",
                      path: "teachers/corrector.py",
                  }, {
                      url: "https://cdn.jsdelivr.net/gh/pointcarre-app/teachers@0.0.4/src/teachers/defaults.py",
                      path: "teachers/defaults.py",
                  }];

                  // Create a new manager with packages and teachers module
                  const manager = await Nagini.createManager(
                      'pyodide',
                      ['sympy', 'pydantic', 'strictyaml'], // Regular packages
                      ['antlr4-python3-runtime'], // Micropip packages  
                      filesToLoad, // Teachers module files
                      'https://cdn.jsdelivr.net/gh/pointcarre-app/nagini@v0.0.21/src/pyodide/worker/worker-dist.js'
                  );

                  await Nagini.waitForReady(manager);

                  // Test sympy
                  const result = await manager.executeAsync('sympy_test.py', `
import sympy as sp
x = sp.Symbol('x')
expr = x**2 + 2*x + 1
factored = sp.factor(expr)
print(f"Expression: {expr}")
print(f"Factored: {factored}")
              `);

                  console.log("‚úÖ Sympy test successful!");
                  console.log("Output:", result.stdout);

                  // Test if teachers module is available
                  const teachersTest = await manager.executeAsync('teachers_test.py', `
import teachers
print("Teachers module loaded successfully!")
print("Available modules:", dir(teachers))
              `);

                  if (teachersTest.exit_code === 0) {
                      console.log("‚úÖ Teachers module loaded!");
                      console.log(teachersTest.stdout);
                  } else {
                      console.warn("‚ö†Ô∏è Teachers module test failed:", teachersTest.stderr);
                  }

                  // Update manager
                  naginiManager = manager;

                  // Success - but don't show UI message
                  console.log("üì¶ All packages and modules loaded successfully!");

                  return true;
              } catch (error) {
                  console.warn("‚ö†Ô∏è Package test failed (this is okay):", error.message);
                  return false;
              }
          }

          // Simple indicator update
          function displayIndicatorNaginiIsReady() {
              const naginiDot = document.getElementById("nagini-dot");
              if (naginiDot) {
                  naginiDot.classList.replace("badge-warning", "badge-success");
              }
              const naginiLabel = document.getElementById("nagini-label");
              if (naginiLabel) {
                  naginiLabel.textContent = "Nagini ready";
              }
          }

          // Simple test function for generators - make it global for debugging
          window.executeAllGenerators = async function executeAllGenerators() {
              console.log("üöÄ executeAllGenerators called!");
              console.log("Nagini:", Nagini);
              console.log("naginiManager:", naginiManager);

              if (!Nagini || !naginiManager) {
                  console.error("‚ùå Nagini or manager not ready");
                  console.error("Nagini:", Nagini);
                  console.error("naginiManager:", naginiManager);
                  alert("Nagini not ready. Wait a few seconds and try again.");
                  return;
              }

              console.log("‚úÖ Nagini and manager are ready, proceeding...");

              // Disable button
              const executeBtn = document.getElementById('execute-all-generators-btn');
              if (executeBtn) {
                  executeBtn.disabled = true;
                  executeBtn.textContent = 'G√©n√©ration...';
              }

              console.log("üöÄ Starting generator execution...");

              // Only test actual generator files, not test files
              const testFiles = [
                  'spe_sujet1_auto_01_question.py',
                  'spe_sujet1_auto_02_question.py',
                  'spe_sujet1_auto_03_question.py'
              ];

              let successCount = 0;
              let failureCount = 0;

              // Get or create results container
              let resultsContainer = document.getElementById('generator-results-container');
              if (!resultsContainer) {
                  resultsContainer = document.createElement('div');
                  resultsContainer.id = 'generator-results-container';
                  document.querySelector('.padding-alt-security')?.appendChild(resultsContainer);
              }

              // Simple results display
              resultsContainer.className = 'mt-6';
              resultsContainer.innerHTML = `
              <div class="text-sm text-gray-600 mb-4">Questions g√©n√©r√©es:</div>
          `;

              // Process each file
              for (const filename of testFiles) {
                  console.log(`\nüîÑ Executing ${filename}...`);

                  const url = `/static/sujets0/generators/${filename}`;

                  try {
                      // Fetch the file
                      const response = await fetch(url);
                      if (!response.ok) {
                          throw new Error(`Failed to fetch: ${response.status}`);
                      }
                      const pythonCode = await response.text();
                      console.log(`Fetched ${filename}, size: ${pythonCode.length} chars`);

                      // Execute with Nagini
                      const result = await naginiManager.executeAsync(filename, pythonCode);
                      console.log(`Result for ${filename}:`, result);

                      // Display result with enhanced formatting for missive data
                      const div = document.createElement('div');
                      // Consider it successful if there's no error and either exit_code is 0 or there's a missive
                      const success = !result.error && (result.exit_code === 0 || result.missive);

                      if (success) {
                          successCount++;
                      } else {
                          failureCount++;
                      }

                      div.className = `p-3 mb-4 border-l-4 ${success ? 'border-green-500 bg-base-100' : 'border-red-500 bg-red-50'}`;

                      let outputHtml = '';

                      // Simple filename display
                      outputHtml += `<div class="text-xs text-gray-500 mb-1">${filename}</div>`;

                      // If there's a missive with question data, display it minimally
                      if (result.missive && success) {
                          try {
                              const missiveData = JSON.parse(result.missive);
                              if (missiveData.statement || missiveData.question) {
                                  // Question statement
                                  outputHtml += `<div class="font-medium mb-2">${missiveData.statement || missiveData.question}</div>`;

                                  // Answer in a subtle way
                                  if (missiveData.answer) {
                                      const answerDisplay = missiveData.answer.simplified_latex ||
                                          missiveData.answer.latex ||
                                          missiveData.answer.simplified_answer ||
                                          missiveData.answer;
                                      outputHtml += `<div class="text-sm text-gray-600">R√©ponse: <span class="font-mono">${answerDisplay}</span></div>`;
                                  }
                              }
                          } catch (e) {
                              // Fallback for non-JSON missive
                              console.log("Missive parsing failed:", e);
                              outputHtml += `<div class="text-sm text-gray-600">Output available but not formatted</div>`;
                          }
                      } else if (!success) {
                          outputHtml += `<div class="text-sm text-red-600">Execution failed</div>`;
                      }

                      // Only show detailed errors in console, not in UI (for cleaner display)
                      if (result.stderr) {
                          console.error(`Full stderr for ${filename}:`, result.stderr);
                      }

                      div.innerHTML = outputHtml;
                      resultsContainer.appendChild(div);

                  } catch (error) {
                      console.error(`Error with ${filename}:`, error);
                      failureCount++;

                      const div = document.createElement('div');
                      div.className = 'p-3 mb-4 border-l-4 border-orange-500 bg-orange-50';
                      div.innerHTML = `
                      <div class="text-xs text-gray-500 mb-1">${filename}</div>
                      <div class="text-sm text-orange-700">Error: ${error.message}</div>
                  `;
                      resultsContainer.appendChild(div);
                  }
              }

              // Add summary
              if (successCount > 0 || failureCount > 0) {
                  const summaryDiv = document.createElement('div');
                  summaryDiv.className = 'mt-4 pt-4 border-t text-sm text-gray-600';
                  summaryDiv.innerHTML = `${successCount} r√©ussi(s), ${failureCount} √©chou√©(s)`;
                  resultsContainer.appendChild(summaryDiv);
              }

              // Re-enable button
              if (executeBtn) {
                  executeBtn.disabled = false;
                  executeBtn.textContent = 'G√©n√©rer';
              }

              console.log("‚úÖ Test complete");
          }

          // Add event listener for execute button - wait for page to be ready
          function setupExecuteButton() {
              console.log("Setting up execute button...");
              const executeBtn = document.getElementById('execute-all-generators-btn');
              if (executeBtn) {
                  console.log("Button found, adding click listener");
                  executeBtn.onclick = async function() {
                      console.log("Button clicked!");
                      await executeAllGenerators();
                  };
              } else {
                  console.log("Button not found!");
              }
          }

          // Try multiple ways to ensure button is set up
          if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', setupExecuteButton);
          } else {
              // DOM is already loaded
              setupExecuteButton();
          }

          // Also try after a delay
          setTimeout(setupExecuteButton, 1000);

          // Run tests if Nagini loaded successfully
          if (Nagini) {
              (async () => {
                  console.log("üöÄ Running Nagini tests...");

                  const basicTest = await testNaginiExecution();
                  if (basicTest) {
                      displayIndicatorNaginiIsReady();

                      // Test with packages after a delay (increased for loading multiple packages)
                      setTimeout(async () => {
                          const packagesLoaded = await testWithPackages();

                          // Enable the execute button once packages are loaded
                          if (packagesLoaded) {
                              const executeBtn = document.getElementById('execute-all-generators-btn');
                              if (executeBtn) {
                                  console.log("Enabling execute button...");
                                  executeBtn.disabled = false;
                                  executeBtn.classList.remove('btn-disabled');
                                  executeBtn.title = 'Click to run generator tests';

                                  // Make sure onclick is set
                                  executeBtn.onclick = async function() {
                                      console.log("Button clicked from enable!");
                                      await executeAllGenerators();
                                  };

                                  console.log("Button enabled and onclick set");
                              } else {
                                  console.log("Button not found when trying to enable");
                              }
                          }
                      }, 2000);
                  }
              })();
          }
  </script>


{% endblock content %}
