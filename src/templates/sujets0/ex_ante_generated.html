{% extends "base/main-alt.html" %}


{% block title %}
  Questions Pré-générées - {{ questions_index.total_attempts | default(questions_index.total_questions) }} questions disponibles
{% endblock title %}

{% block extra_head %}

  {#
{% block extra_head %}
  <!-- Include KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
{% endblock extra_head %} #}


  {# Product-specific metatags override defaults #}
  {% if product_metatags %}
    {# SEO metatags #}
    {% if product_metatags.description %}
      <meta name="description" content="{{ product_metatags.description }}" />
    {% endif %}
    {% if product_metatags.keywords %}
      <meta name="keywords" content="{{ product_metatags.keywords }}" />
    {% endif %}
    {% if product_metatags.robots %}
      <meta name="robots" content="{{ product_metatags.robots }}" />
    {% endif %}

    {# Open Graph metatags #}
    {% if product_metatags['og:title'] %}
      <meta property="og:title" content="{{ product_metatags['og:title'] }}" />
    {% endif %}
    {% if product_metatags['og:description'] %}
      <meta property="og:description" content="{{ product_metatags['og:description'] }}" />
    {% endif %}
    {% if product_metatags['og:image'] %}
      <meta property="og:image" content="{{ product_metatags['og:image'] }}" />
    {% endif %}
    {% if product_metatags['og:url'] %}
      <meta property="og:url" content="{{ product_metatags['og:url'] }}" />
    {% endif %}

    {# Twitter Card metatags #}
    {% if product_metatags['twitter:card'] %}
      <meta name="twitter:card" content="{{ product_metatags['twitter:card'] }}" />
    {% endif %}
    {% if product_metatags['twitter:title'] %}
      <meta name="twitter:title" content="{{ product_metatags['twitter:title'] }}" />
    {% endif %}
    {% if product_metatags['twitter:description'] %}
      <meta name="twitter:description" content="{{ product_metatags['twitter:description'] }}" />
    {% endif %}
    {% if product_metatags['twitter:image'] %}
      <meta name="twitter:image" content="{{ product_metatags['twitter:image'] }}" />
    {% endif %}

    {# Dublin Core metatags #}
    {% for key, value in product_metatags.items() %}
      {% if key.startswith('DC.') %}<meta name="{{ key }}" content="{{ value }}" />{% endif %}
    {% endfor %}

    {# Any other custom metatags #}
    {% if product_metatags.revised %}
      <meta name="revised" content="{{ product_metatags.revised }}" />
    {% endif %}
    {% if product_metatags.topic %}
      <meta name="topic" content="{{ product_metatags.topic }}" />
    {% endif %}
    {% if product_metatags.summary %}
      <meta name="summary" content="{{ product_metatags.summary }}" />
    {% endif %}
    {% if product_metatags.category %}
      <meta name="category" content="{{ product_metatags.category }}" />
    {% endif %}
  {% endif %}

  {# Backend settings disabled - we load Nagini manually in the content block #}
{% endblock extra_head %}

{% block modal_info_content %}
  {% include "sujets0/modal-info-content.html" %}
{% endblock modal_info_content %}

{% block content %}
  <div class="padding-alt-security mx-auto mb-14 mt-12 max-w-3xl ">
    {% include "sujets0/header.html" %}
  </div>


  <div class="padding-alt-security mx-auto mb-14 mt-12 max-w-5xl">

    <!-- Header -->
    <div class="card shadow-lg mx-auto py-6 mb-8">
      <h1 class="text-center text-2xl font-bold text-base-content/60 mb-1">Questions Pré-générées</h1>
      <h2 class="text-center text-xl font-bold mb-3">
        {{ questions_index.total_attempts | default(questions_index.generators|length * 100) }} questions mathématiques disponibles
      </h2>

      <!-- Statistics -->
      <div class="stats stats-horizontal shadow-none mx-auto">
        <div class="stat">
          <div class="stat-title">Générateurs</div>
          <div class="stat-value text-primary">{{ questions_index.generators|length }}</div>
          <div class="stat-desc">Fichiers Python</div>
        </div>
        <div class="stat">
          <div class="stat-title">Total</div>
          <div class="stat-value text-secondary">
            {{ questions_index.total_attempts | default(questions_index.generators|length * 100) }}
          </div>
          <div class="stat-desc">Questions générées</div>
        </div>
        <div class="stat">
          <div class="stat-title">Réussies</div>
          <div class="stat-value text-success">
            {{ questions_index.total_successful | default(questions_index.total_questions) }}
          </div>
          <div class="stat-desc">
            {{ ((questions_index.total_successful | default(questions_index.total_questions) ) * 100 / (questions_index.total_attempts | default(questions_index.generators|length * 100))) | round(1) }}% de succès
          </div>
        </div>
      </div>
    </div>

    <!-- Filters and Controls -->
    <div class="card bg-base-100 shadow-xl mb-6">
      <div class="card-body">
        <form class="space-y-6 w-full">
          <!-- Top row: Generator selector (full width) -->
          <fieldset class="space-y-2">
            <legend class="label">
              <span class="label-text font-semibold">Générateur</span>
            </legend>
            <select id="generator-select" class="select select-bordered w-full">
              <option value="all">Tous les générateurs</option>
              {% for generator in questions_index.generators %}
                <option value="{{ generator.name }}">
                  {{ generator.name }}
                  {% if generator.level %}[{{ generator.level }}]{% endif %}
                  ({{ generator.successful }}/100)
                </option>
              {% endfor %}
            </select>
          </fieldset>

          <!-- Two columns for filters on larger screens -->
          <div class="flex flex-col sm:flex-row sm:gap-6">
            <!-- Left column -->
            <div class="flex-1 space-y-4">
              <fieldset class="space-y-2">
                <legend class="label">
                  <span class="label-text font-semibold">Statut des questions</span>
                </legend>
                <select id="status-select" class="select select-bordered w-full">
                  <option value="all">Toutes les questions</option>
                  <option value="success">✓ Questions réussies</option>
                  <option value="failed">✗ Questions échouées</option>
                </select>
                <p class="text-xs text-base-content/60">Filtrer par statut de génération</p>
              </fieldset>
            </div>

            <!-- Right column -->
            <div class="flex-1 space-y-4">
              <fieldset class="space-y-2">
                <legend class="label">
                  <span class="label-text font-semibold">Questions par page</span>
                </legend>
                <select id="per-page-select" class="select select-bordered w-full">
                  <option value="10">10 questions</option>
                  <option value="20" selected>20 questions</option>
                  <option value="50">50 questions</option>
                  <option value="100">100 questions</option>
                </select>
                <p class="text-xs text-base-content/60">Nombre de questions à afficher</p>
              </fieldset>
            </div>
          </div>

          <!-- Search field (full width) -->
          <fieldset class="space-y-2">
            <legend class="label">
              <span class="label-text font-semibold">Recherche</span>
            </legend>
            <div class="join w-full">
              <input type="text"
                     id="search-input"
                     placeholder="Rechercher dans les questions..."
                     class="input input-bordered join-item flex-1" />
              <button type="button" class="btn btn-square join-item">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-5 w-5"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </button>
            </div>
            <p class="text-xs text-base-content/60">Rechercher par mot-clé dans le contenu des questions</p>
          </fieldset>

          <!-- Action button -->
          <fieldset>
            <button id="load-all-btn" type="button" class="btn btn-primary btn-outline w-full">
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="h-5 w-5 mr-2"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Charger toutes les questions
            </button>
          </fieldset>
        </form>
      </div>
    </div>

    <!-- Loading indicator -->
    <div id="loading-indicator" class="hidden">
      <div class="flex justify-center items-center py-8">
        <span class="loading loading-spinner loading-lg"></span>
        <span class="ml-3">Chargement des questions...</span>
      </div>
    </div>

    <!-- Questions container -->
    <div id="questions-container" class="space-y-4">
      <!-- Questions will be loaded here -->
    </div>

    <!-- Pagination -->
    <div id="pagination-container" class="flex justify-center mt-8">
      <!-- Pagination will be rendered here -->
    </div>
  </div>

  <!-- Pass Jinja2 data via data attributes -->
  <div id="jinja-data"
       data-questions-index='{{ questions_index | tojson }}'
       data-questions-base-url="{{ questions_base_url }}"
       style="display: none"></div>

  <script type="module">
      // Import the pre-generated viewer module
      import preGeneratedViewer from '/static/js/sujets0/pre-generated-viewer.js';

      // Initialize when DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
          preGeneratedViewer.init();
      });
  </script>


{% endblock content %}


<!-- Load Sujets0 main module -->
{# <script type="module">
     import {
         init
     } from '/static/js/sujets0/sujets0-main.js';

     // Initialize the module when DOM is ready
     if (document.readyState === 'loading') {
         document.addEventListener('DOMContentLoaded', init);
     } else {
         // DOM is already loaded
         init();
     }
 </script> #}
